# 動作確認チェックリスト

## 1. データベース設定確認

### SQL実行
- [ ] `supabase-subscription-schema.sql` をSupabase SQL Editorで実行
- [ ] テーブル作成確認: `subscriptions`, `sales`
- [ ] RLSポリシー確認: ユーザー分離と管理者権限
- [ ] ビュー/RPC関数確認: `v_revenue_summary`, `get_revenue_summary()`, `get_active_subscriptions()`

### 確認コマンド
```sql
-- テーブル存在確認
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('subscriptions', 'sales');

-- RLSポリシー確認
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE tablename IN ('subscriptions', 'sales');
```

## 2. 認証機能確認

### ユーザー登録・ログイン
- [ ] 新規ユーザー登録が正常に動作する
- [ ] 登録後、即座にログインできる
- [ ] 既存ユーザーのログインが正常に動作する
- [ ] ログアウトが正常に動作する

### 管理者権限
- [ ] 管理者アカウントでログイン
- [ ] `/admin` ページにアクセス可能
- [ ] 一般ユーザーは `/admin` にアクセスできない

## 3. サブスクリプション機能確認

### 決済フロー
- [ ] `/upgrade` ページが正常に表示される
- [ ] プラン選択（月額・年額）が動作する
- [ ] Stripe Checkoutページにリダイレクトされる
- [ ] テストカードでの決済が成功する

### Webhook処理
- [ ] 決済成功後、`subscriptions` テーブルが更新される
- [ ] ユーザーのサブスクリプションステータスが `active` になる
- [ ] `sales` テーブルに売上記録が追加される

### 権限制御
- [ ] 無料ユーザーは `/analytics` にアクセスできない
- [ ] 有料ユーザーは全機能にアクセス可能
- [ ] 管理者は全機能にアクセス可能

## 4. ダッシュボード機能確認

### 一般ユーザー
- [ ] `/dashboard` ページが正常に表示される
- [ ] サブスクリプション状況が正しく表示される
- [ ] アップグレードボタンが表示される
- [ ] 機能制限が正しく表示される

### 有料ユーザー
- [ ] プレミアムプラン表示
- [ ] 全機能アクセス可能
- [ ] サブスクリプション期限表示

### 管理者
- [ ] 管理者ダッシュボードアクセス
- [ ] 売上サマリー表示
- [ ] アクティブサブスクリプション一覧
- [ ] 月別売上推移グラフ

## 5. データ分離確認

### ユーザーデータ分離
- [ ] ユーザーAのデータがユーザーBに見えない
- [ ] CSVデータが正しくユーザーIDで紐付けられる
- [ ] モデルデータがユーザーIDで分離される

### 管理者アクセス
- [ ] 管理者が全ユーザーのデータを閲覧可能
- [ ] 管理者が全ユーザーの売上を閲覧可能
- [ ] 管理者が全サブスクリプションを閲覧可能

## 6. エラーハンドリング確認

### 認証エラー
- [ ] 未認証ユーザーの適切なリダイレクト
- [ ] 権限不足ユーザーの適切なリダイレクト
- [ ] セッション期限切れの処理

### 決済エラー
- [ ] 決済失敗時の適切なエラー表示
- [ ] Webhook処理失敗時のログ出力
- [ ] ネットワークエラー時の適切な処理

## 7. パフォーマンス確認

### ページロード
- [ ] ダッシュボードの読み込み速度
- [ ] 管理者ページの読み込み速度
- [ ] 大量データでのパフォーマンス

### データベース
- [ ] RLSポリシーの実行効率
- [ ] インデックスの効果
- [ ] 複雑なクエリの実行時間

## 8. セキュリティ確認

### データ保護
- [ ] ユーザーデータの適切な分離
- [ ] 管理者権限の適切な制御
- [ ] 機密情報の適切な保護

### API セキュリティ
- [ ] Webhook署名検証
- [ ] 環境変数の適切な管理
- [ ] 不正アクセスの防止

## 9. 本番環境確認

### デプロイ
- [ ] Vercelへの正常なデプロイ
- [ ] 環境変数の適切な設定
- [ ] ドメイン設定の確認

### 本番機能
- [ ] 本番Stripeキーでの決済
- [ ] 本番Webhookの動作
- [ ] SSL証明書の確認

## 10. ユーザビリティ確認

### UI/UX
- [ ] 直感的なナビゲーション
- [ ] 適切なエラーメッセージ
- [ ] レスポンシブデザイン
- [ ] ローディング状態の表示

### アクセシビリティ
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] 色のコントラスト





